# 用例设计与实现规范优化 - Proposal

## Why

当前 `openspec/测试用例设计与实现规范.md` 只规定了「测试与验证」要列 Scenario 与覆盖策略、实现用 Vitest 与 describe/it，没有规定**设计阶段每条用例写什么**（测什么、什么条件、期望、断言要点）以及**实现阶段测试文件与单条用例怎么写**（文件结构、describe 分层、条件构造、断言方式）。导致写 design 时测试设计不够可执行、写单测时缺少统一形状，设计与实现难以一一对应。

## What Changes

- 在规范中**扩展「设计怎么写」**：规定 design 的「测试与验证」里每条用例设计必须包含「测什么、条件、期望、断言要点」，并给出表格或示例。
- 在规范中**扩展「实现怎么写」**：规定测试文件结构（文件头、describe 分层）、单条 it 的 arrange/act/assert、断言与 design「断言要点」的对应关系及推荐风格。
- 增加**设计 ↔ 实现对应关系**说明：design 中一条用例设计对应实现里一个或一组 it，实现时按「条件」构造、按「断言要点」写 expect，便于追溯与验收。

## Capabilities

### New Capabilities

- `test-design-and-implementation-spec`: 规定「测试用例设计与实现规范」文档的必备结构与内容——包含设计阶段（每条用例的测什么/条件/期望/断言要点）与实现阶段（测试文件结构、describe-it 分层、条件构造与断言方式），以及设计与实现的对应关系。

### Modified Capabilities

- （无：本变更仅针对规范文档本身，不修改其他已有 spec 的行为。）

## Impact

- **openspec/测试用例设计与实现规范.md**：新增/重写「设计怎么写」「实现怎么写」「设计↔实现对应」等小节，文档变长、结构更明确。
- **openspec/config.yaml**：无需修改；现有 rules 已引用该规范。
- 后续所有 change 的 design「测试与验证」与单测实现将按新规范执行，可追溯性更好。
