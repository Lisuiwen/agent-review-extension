# OpenSpec 配置
# 说明：schema 决定变更产物的类型与顺序；context 与 rules 用于约束各产物的内容与质量。
# 测试相关：design/tasks 中「测试」的流程与产物约定由此处规定；测试用例本身的设计与实现规则见 openspec/测试用例设计与实现规范.md。
schema: spec-driven

# 项目上下文：供 AI 创建产物时参考（技术栈、编码约定、OpenSpec 流程中的测试约定）
context: |
  Tech stack: TypeScript, Vitest, VS Code Extension API.
  编码约定：所有包含中文的新建或修改内容必须使用 UTF-8 编码保存，所有产物文档使用中文。
  OpenSpec 流程中的测试约定：
  - design.md 必须包含「测试与验证」小节；其格式（Scenario 列表、覆盖策略、每条用例设计的测什么/条件/期望/断言要点）见 openspec/测试用例设计与实现规范.md 的「设计怎么写」； 若该任务无需单元测试则说明无需更改或新增测试。 本节需要额外判断是否可以使用TDD 参考[tdd-workflow.md](.cursor/skills/tdd-workflow.md)。
  - tasks.md 必须包含至少一项与测试相关的任务（新增/修改测试或明确说明无需测试），并与 design 中「测试与验证」一致；需新增的测试在 tasks 中应有对应可勾选任务，实现后勾选，并可在 design 中更新「已有覆盖」。
  - 若 design「测试与验证」标明某逻辑采用 TDD，执行实现（apply）时须：(1) 按「先写失败用例再实现」顺序执行，参考 .cursor/skills/tdd-workflow.md；(2) 每完成「写失败用例」类任务后运行相关测试并确认失败原因符合预期（Red）；(3) 每完成对应实现任务后运行相关测试并确认通过（Green），再勾选任务；(4) 凡「运行 xxx 测试并确认通过」类任务，须先实际执行测试、全部通过后再勾选，不得仅勾选不跑测。

# 各产物规则：key 需与 schema 中 artifact id 一致（proposal / specs / design / tasks）
rules:
  proposal:
    - 保持简洁，明确 Why 与 What；若对测试有影响可一句话说明。
  specs:
    - 涉及行为变更时，每个 Requirement 下应有可验证的 Scenario（WHEN/THEN/AND），便于后续对应到测试任务。
  design:
    - 必须包含「测试与验证」小节：列出本变更涉及的 spec Scenario、已有/需新增覆盖及目标文件；每条用例设计须含测什么、条件、期望、断言要点（格式与表格见 openspec/测试用例设计与实现规范.md §2）；若有特殊 mock/fixture 可在此说明。
    - 完成设计后需要给出实现难度、风险评估
  tasks:
    - 必须包含至少一项与测试相关的任务（新增/修改测试或明确说明无需测试），并与 design 中「测试与验证」一致；凡「需新增」的测试在 tasks 中应有对应可勾选任务。
    - 若 design「测试与验证」标明某逻辑采用 TDD，tasks 中相关实现任务须体现先测后实现：要么将「先写该行为的失败单测」作为独立任务排在对应实现任务之前，要么在实现任务描述中注明「按 TDD：先写失败用例再实现」。
    - 凡包含「运行…测试」「验收…通过」等的任务，其完成条件须为「已实际运行并通过」；勾选前必须执行测试并确认通过，不得仅勾选不跑测。
