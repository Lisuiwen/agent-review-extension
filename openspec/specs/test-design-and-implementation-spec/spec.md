# 测试用例设计与实现规范 - 需求规格

规范测试用例在设计阶段与实现阶段的格式、结构与对应关系，便于从 design 到单测的可追溯与一致实现。

## Requirements

### Requirement: 设计阶段每条用例设计必备四项

「测试用例设计与实现规范」文档 SHALL 规定单条用例设计的格式：每条用例设计（或每个需覆盖的 Scenario）必须包含四项：测什么、条件、期望、断言要点。文档 SHALL 提供表格模板或示例，便于填写与实现时对照。该格式适用于在 design 的「测试与验证」等场景中书写时（该场景是否必选由 openspec/config 约定）。

#### Scenario: 规范中可见设计四项与表格或示例

- **WHEN** 读者打开 `openspec/测试用例设计与实现规范.md` 并查看「设计怎么写」小节
- **THEN** 文档中明确列出每条用例设计须包含「测什么、条件、期望、断言要点」
- **AND** 文档中包含至少一处表格模板或示例（如 astScope 截断场景），展示四项如何填写

#### Scenario: 断言要点可直接指导实现

- **WHEN** 实现者根据 design 的「测试与验证」编写单测
- **THEN** 设计中的「断言要点」列可直接转化为 it 内的 expect 语句，无需二次推断
- **AND** 规范中说明断言要点与 expect 的对应关系（如「断言要点」→ 实现时必验的 expect）

---

### Requirement: 实现阶段测试文件结构与单条用例写法

「测试用例设计与实现规范」文档 SHALL 规定实现阶段：测试文件结构（文件头、describe 分层）、单条 it 的 arrange/act/assert、断言与设计文档中「断言要点」的对应及推荐风格。文档 SHALL 使实现者能按规范写出结构一致、可追溯的测试代码。

#### Scenario: 规范中规定文件头与 describe 分层

- **WHEN** 读者查看规范的「实现怎么写」部分
- **THEN** 文档规定测试文件头部应说明所测模块及对应的 spec/design（或 change 名）
- **AND** 文档规定 describe 分层规则：顶层为被测对象，下一层为场景/Scenario 或条件类型，必要时再细分

#### Scenario: 规范中规定单条 it 的 arrange/act/assert 与断言风格

- **WHEN** 实现者编写单条 it
- **THEN** 规范要求 it 内按 arrange（条件构造）→ act（调用/触发）→ assert（按断言要点写 expect）组织
- **AND** 规范推荐断言风格：先判非 null/形态，再判关键字段；断言与设计中的「断言要点」一一对应

---

### Requirement: 设计与实现的对应关系

「测试用例设计与实现规范」文档 SHALL 包含「设计 ↔ 实现对应关系」说明：每条用例设计（或表格中的一行）对应实现里的一个或一组 it；实现时按设计中的「条件」构造输入、按「断言要点」写 expect；实现完成后可按流程更新已有覆盖或作验收（与 design/tasks 的衔接由 openspec/config 约定）。

#### Scenario: 规范中明确一条设计对应一个或一组 it

- **WHEN** 读者查看规范中关于设计↔实现对应的部分
- **THEN** 文档明确说明每条用例设计（或表格中的一行）对应实现中一个或一组 it
- **AND** 文档说明实现时如何按「条件」列构造、按「断言要点」列写 expect

#### Scenario: 规范中说明追溯与验收方式

- **WHEN** 实现完成或归档 change 时做验收
- **THEN** 规范说明可通过 it 与断言要点的对应关系做追溯与自检；与 design/tasks 的衔接由 config 约定
- **AND** 检查清单中包含与设计↔实现一致性相关的项（可选）
